@using TerranForum.Domain.Models
@using Microsoft.AspNetCore.Identity
@using TerranForum.Application.Services
@using System.ComponentModel.DataAnnotations
@model Post

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@foreach (var paragraph in Model.Content.Split("\r\n\r\n"))
{
    <p>@paragraph</p>
}
@if (UserManager.GetUserId(User) == Model.UserId)
{
    <div class="container mb-2" id="managePost" postId="@Model.Id" forumId="@Model.ForumId">
        <a asp-controller="Post" asp-action="GetPostDeleteView" class="danger-anchor">Delete</a>
    </div>
}
<div class="container-fluid pb-4">
    <div class="d-flex justify-content-end">
        @Model.User.UserName
    </div>
    <div class="d-flex justify-content-start" postId="@Model.Id" id="ratingModifyContainer">
        @if (SignInManager.IsSignedIn(User))
        {
            <a class="px-2"  
                id="like"
                asp-controller="Post"
                asp-action="UpdateRating">Like</a>    
            <div class="px-1">@Model.Ratings.Sum(x => x.Value)</div>
            <a class="px-2"
                id="dislike"
                asp-controller="Post"
                asp-action="UpdateRating">Dislike</a>
        }
        else
        {
            <a class="px-2"
               asp-area="Identity"
               asp-page="/Account/Login">Like</a>
            <div class="px-1">@Model.Ratings.Sum(x => x.Value)</div>
            <a class="px-2"
               asp-area="Identity" 
               asp-page="/Account/Login">Dislike</a>
        }
    </div>
</div>
<div class="container">
    @foreach (var reply in Model.Replies)
    {
        await Html.RenderPartialAsync(
            "~/Views/PostReply/_PostReplyPartial.cshtml",
            reply);
    }
    <div id="createReply">
        @if (SignInManager.IsSignedIn(User))
        {
            <a class="replyAchor" 
                asp-controller="Post" 
                asp-action="GetCreatePostReplyView" 
                postId="@Model.Id" 
                forumId="@Model.ForumId" 
                id="addReply">Add Comment</a>
        }
        else
        {
            <a class="nav-link" asp-area="Identity" asp-page="/Account/Login">Add Comment</a>
        }
    </div>
</div>
